# =====  ANSIBLE  ============================================================
#          NAME:  site.yml
#   DESCRIPTION:  Entry point for playbook
# ============================================================================
---
- name: Deploy and install dotfiles

  pre_tasks:
    - name: Pre-installation cleanup
      ansible.builtin.file:
        path: /var/tmp/ansible-installer
        state: absent
    - name: Create temporary directory for setup checkout
      ansible.builtin.file:
        path: /var/tmp/ansible-installer
        state: directory
        mode: '0700'
        owner: khuntly
        group: users
    - name: Create temporary directory for dotfiles checkout
      ansible.builtin.file:
        path: /var/tmp/dotfiles
        state: directory
        mode: '0700'
        owner: khuntly
        group: users

  hosts: dotfiles
  become: true
  become_user: khuntly
  roles:
    - common
    - install_dotfiles

  post_tasks:
    - name: Post-installation cleanup of /var/tmp/ansible-installer
      ansible.builtin.file:
        path: /var/tmp/ansible-installer
        state: absent
    - name: Post-installation cleanup of /var/tmp/dotfiles
      ansible.builtin.file:
        path: /var/tmp/dotfiles
        state: absent
